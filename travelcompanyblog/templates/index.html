{% extends "base.html" %}

{% block content %}
<div class="container" style="margin-top: 60px;">

<div class="bg-hero rounded-4 p-5 mb-5 text-center text-md-start">
  <h1 class="display-5 fw-bold mb-3">Travel & Food Blog</h1>
  <p class="lead mb-4">
    Inspiring journeys, hidden gems and real stories from travellers like you.
  </p>

  <div class="d-flex flex-column flex-sm-row gap-2">
    <a href="{{ url_for('core.info') }}" class="btn btn-accent btn-lg me-sm-3 mb-2 mb-sm-0">
      Learn more
    </a>

    {% if current_user.is_authenticated %}
      <a href="{{ url_for('blog_posts.create_post') }}" class="btn btn-outline-accent btn-lg">
        + Create a new post
      </a>
    {% else %}
      <a href="{{ url_for('users.register') }}" class="btn btn-outline-accent btn-lg">
        Join the community
      </a>
    {% endif %}
  </div>
</div>
</div>

<div class="row g-4">
  {% for post in blog_posts.items %}
    <div class="col-md-6 col-lg-4">
      <div class="card h-100 shadow-sm border-0 blog-card">
        <div class="card-body d-flex flex-column">

          <div class="d-flex align-items-center mb-3">
            <div class="avatar-circle me-2">
              {{ post.author.username[0]|upper }}
            </div>
            <div>
              <small class="text-muted d-block">
                By <a href="{{ url_for('users.user_posts', username=post.author.username) }}"
                      class="author-link">
                      {{ post.author.username }}
                    </a>
              </small>
              <small class="text-muted">
                {{ post.date.strftime('%d %b %Y') }}
              </small>
            </div>
          </div>

          <h5 class="card-title mb-2">
            <a href="{{ url_for('blog_posts.blog_post', blog_post_id=post.id) }}"
               class="stretched-link text-decoration-none text-dark">
              {{ post.title }}
            </a>
          </h5>

          <p class="card-text text-muted flex-grow-1">
            {{ post.text[:160] }}{% if post.text|length > 160 %}...{% endif %}
          </p>

          <div class="mt-3">
            <a class="btn btn-sm btn-accent"
               href="{{ url_for('blog_posts.blog_post', blog_post_id=post.id) }}">
              Read post
            </a>
          </div>

        </div>
      </div>
    </div>
  {% else %}
    <div class="col-12 text-center py-5">
      <p class="text-muted mb-3">No posts yet. Be the first to share your travel story!</p>
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('blog_posts.create_post') }}" class="btn btn-accent">
          Create your first post
        </a>
      {% endif %}
    </div>
  {% endfor %}
</div>

<nav aria-label="Page navigation" class="mt-5">
  <ul class="pagination justify-content-center">
    {% for page_num in blog_posts.iter_pages(left_edge=1, left_current=2,
                                             right_current=2, right_edge=1) %}
      {% if page_num %}
        <li class="page-item {% if blog_posts.page == page_num %}active{% endif %}">
          <a class="page-link"
             href="{{ url_for('core.index', page=page_num) }}">{{ page_num }}</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">â€¦</span></li>
      {% endif %}
    {% endfor %}
  </ul>
</nav>

{% endblock %}
